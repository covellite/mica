!function(t){"use strict";t.fn.mica=function(i){function o(i){t("#overlay").fadeOut(200),i!=m.modalContentsId?t(i).css({display:"none"}):t(i).remove()}var n,e,d,a,r,l,s,c,f,h,p={top:0,modalMarginW:50,modalMarginH:30,modalBorder:5,overlay:.8,closeButton:null,modalContentsId:"#modal",imgWrapId:"#modalInner",navigation:!0},m=t.extend({},p,i);return t("body").append('<div id="overlay"></div>'),this.each(function(){t(this).click(function(i){if(t("#overlay").css({display:"block",opacity:"0"}).fadeTo(200,m.overlay).bind("click",function(){o(e)}),t(m.closeButton).bind("click",function(){o(e)}),t(this).attr("href").match(/^#.+/))e=t(this).attr("href"),s=t(e).outerWidth(),c=t(e).outerHeight(),l=t(window).height()-2*m.modalMarginH,m.top=(l-c)/2,t(e).css({position:"fixed",opacity:"0","z-index":"10000",top:m.top+m.modalMarginH+"px",left:"50%","margin-left":-(s/2)+"px"}).fadeTo(200,1),i.preventDefault();else{e=m.modalContentsId,n=m.imgWrapId,d=t(this).attr("class"),0==t(e).size()&&t("body").append('<div id="modal"><div id="modalInner"></div></div>'),t(n).html('<img src="'+t(this).attr("href")+'" alt="" />'),a=d.split(" ");for(var p in a)if(0==a[p].indexOf("mica-")){h=a[p];break}f=t("."+h).index(t(this)),t(n).find("img").bind("load",function(){t(this).css({width:"auto",height:"auto"}),s=t(e).find("img").width(),c=t(e).find("img").height(),r=t(window).width()-2*(m.modalMarginW+m.modalBorder),l=t(window).height()-2*(m.modalMarginH+m.modalBorder),r>=s&&l>=c?(s=s,c=c):s>r?l>=c?(s/r>=c/l?console.log(1):console.log(2),c=Math.floor(r*c/s),s=r):s/r>=c/l?(c=Math.floor(c/(s/r)),s=r):(s=Math.floor(s/(c/l)),c=l):(s=Math.floor(l*s/c),c=l),t(this).css({width:s+"px",height:c+"px"}),m.top=(l-c)/2,m.navigation&&(t(m.modalContentsId).find("#prev").remove(),t(m.modalContentsId).find("#next").remove(),t(m.modalContentsId).append('<div id="prev" class="navigation">prev</div><div id="next" class="navigation">next</div>'),t("#prev").css({top:c/2-t("#prev").height()/2+"px"}),t("#next").css({top:c/2-t("#next").height()/2+"px"}),t("#prev").bind("click",function(){0==f?(t(n).find("img").attr("src",t("."+h).eq(t("."+h).length-1).attr("href")),f=t("."+h).length-1):(t(n).find("img").attr("src",t("."+h).eq(f-1).attr("href")),f-=1)}),t("#next").bind("click",function(){f==t("."+h).length-1?(t(n).find("img").attr("src",t("."+h).eq(0).attr("href")),f=0):(t(n).find("img").attr("src",t("."+h).eq(f+1).attr("href")),f+=1)})),t(e).css({position:"fixed",opacity:"0","z-index":"10000",top:m.top+m.modalMarginH+"px",left:"50%",border:m.modalBorder+"px solid #FFF","margin-left":-((s+2*m.modalBorder)/2)+"px"}).fadeTo(200,1)}),i.preventDefault()}})})}}(jQuery);